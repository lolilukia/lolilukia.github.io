---
title: 微信小程序入门指南
date: 2018-01-31 18:58:47
tags: 技术
---

人生中第一个微信小程序终于完工了，原本是个功能非常简单的工具，因为第一次做，期间经历了换后台框架、等待证书和调试等等坎坷，在这篇博客中将整个开发流程整理一下，以便后续参考。

## 准备工作

### 注册小程序

小程序和公众号共用一个注册入口[微信公众平台](https://mp.weixin.qq.com/)，注册时选择小程序

<!--more-->

流程大概是填写一系列登录信息和身份信息，注册的邮箱作为每次登录的凭证，每个邮箱只能申请一个小程序

![](https://podcast.webview.tech/lolilukia/20200220qZ5qxQ.png)

注册完成之后可以进行一些设置，我用到的设置只有基本设置和开发设置，基本设置包括小程序头像、名称、类目和简介等，开发设置包括开发者ID和服务器域名两部分

![](https://podcast.webview.tech/lolilukia/20200220v258Ef.png)

其中开发者ID部分包括小程序ID和AppSecret小程序密钥，首次注册的时候选择生成密钥然后保存，如后续需要使用微信API（如获取openid等）需要AppID和AppSecret

服务器域名要求小程序后台请求域名已备案并开启https，进行配置后才能成功发起请求

![](https://podcast.webview.tech/lolilukia/20200220tQqeX8.png)

### 域名配置

后台服务器我选的是阿里云的云虚拟主机，其中共享虚拟主机普惠版只要6元/年，性价比极高，包含200M网页空间，10G月流量和20M数据库空间，作为一个小工具完全够用了，缺点是不能远程登录，只支持html和php，操作系统建议选择linux

然后就是备案，过程就是填写一些个人信息，购买幕布，拍照并上传，可能整个过程需要5到10天，并不是很久

[备案的具体说明](https://help.aliyun.com/knowledge_detail/36895.html?spm=5176.200021.n2.19.uYQ0So)

然后就是后台程序的开发，由于不能远程登录，所以调试修改有些麻烦。目前云虚拟主机支持的PHP版本最高为5.5，我使用的框架是Yii2的basic版，上传源码时需要将整个包上传（一定要包含vendor），Yii2的具体细节下面会进行介绍

微信小程序要求服务器域名开启https，这个内容在上一篇博客中有介绍

[阿里云云虚拟主机配置https](http://lolilukia.com/2018/01/24/%E9%98%BF%E9%87%8C%E4%BA%91%E4%BA%91%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AEhttps/)

### 数据库配置

此前我一直使用的mysql workbench，但使用了虚拟主机上的数据库之后，应用就经常发生卡顿和无法响应的情况，后来我发现阿里云提供了数据库操作的相关服务，选择**云虚拟主机->管理->数据库信息->管理**，然后进入**DMS**数据管理工具的登录页面

![](https://podcast.webview.tech/lolilukia/20200220brq2ni.png)

第一行的格式是**主机域名(my3w.com):3306**，第二行是数据库的用户名，第三行是数据库密码，用户名和密码都是申请主机时系统分配的，查看主机信息可以获取

登录进去左上角是数据库名称，一般为**用户名_db**，这里没有太值得注意的，为了使中文能够正常存储和使用，相关字段的编码设置为**utf-8**

### Yii2框架配置

这里只介绍框架的配置，框架的结构如图

![](https://podcast.webview.tech/lolilukia/20200220D4MClH.png)

**config**包含应用、数据库配置，**controllers**包含控制器，其中的action是请求参数的入口，**models**中的模型一般与数据库表相对应，有点像java中的java bean，**vendor**包含的是第三方类库，**web**中的index.php是访问入口

#### db.php

![](https://podcast.webview.tech/lolilukia/20200220OF1Rcp.png)

#### web.php

![](https://podcast.webview.tech/lolilukia/20200220SJVME1.png)

关闭**csrf**是防止访问时出现400错误码

### 小程序调试

小程序开发使用的是微信开发者工具，调试器和浏览器开发者工具有点类似，其中**AppData**可以跟踪每个页面的data值，比较直观

![](https://podcast.webview.tech/lolilukia/20200220ijnZt1.png)

另外，为了防止开发者工具和真机出现不一致的情况，开发者工具还提供了真机调试的功能，点击预览，扫描二维码，就可以在手机上看到该小程序的开发版

![](https://podcast.webview.tech/lolilukia/20200220f3Odw1.png)





