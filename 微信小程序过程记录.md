---
title: 微信小程序过程记录（一）
date: 2017-10-08 10:02:07
tags: 技术
---
前两篇博客记录了微信小程序开发的一些准备工作，由于时间紧迫，需要前后端同时推进，这篇博客就记录其中一些比较繁杂凌乱的过程。

### mysql存储中文数据

想到同学的真实姓名要使用中文，理论上说mysql安装之后默认不支持中文存储，最便捷的方式当然是修改表的字符集。
<!--more-->
方法是选中表，右键选择**Alter table**，然后就是下图的样子，修改某些列的**Collection**，一般选择**utf8_bin**，与ci不同的是，这种字符集大小写敏感。然后点击Apply即可。
![](https://podcast.webview.tech/lolilukia/20200220t2oQjQ.png)

### 使用PHP重写

作为一个命途多舛的编程绝缘体，还是没有经受住命运的拷问。在使用Python-Flask写完一个功能之后，突然想到先把服务器租起来吧，综合实用性和性价比，租了云虚拟主机。目前虚拟主机能否承受得住100人左右的并发尚不可知，但可以肯定的是**虚拟主机不支持python,只能拿php重写**。

于是我就使用yii2框架来实现小程序的后台，框架的搭建前文已经提到过了，在此不进行赘述。当然，虚拟主机不支持ssh远程登录，只能将vendor等文件夹一起传到根目录中。

在将后台api打包上传至虚拟主机之后，出现了以下的问题：

> include(/data/home/xxx/yiisoft/yii2/web/Memberer.php): failed to open stream: No such file or directory

觉得非常地诡异，解决方式如下：

1）设置全局composer命令

```bash
mv composer.phar /usr/local/bin/composer
```

2）删除vendor目录，更新vendor目录

```bash
composer install
```

### 虚拟主机删除文件错误码550

更新后台代码包的时候，需要将之前的文件夹删掉，但是删除的时候出现了以下的错误：

> 550 Remove directory operation failed

其实是隐藏文件的问题，我使用的FTP工具是**FileZilla**，解决办法是选择菜单栏服务器-强制显示隐藏文件，重新连接服务器，通常要重连几遍才能删彻底。

### 复制新项目出现问题

更新vendor目录后的项目出现了以下的错误：

> exception 'yii\base\InvalidRouteException' with message 'Unable to resolve the request "site/error".' in /Users/yuzhiyuan/Documents/htdocs/yii-application/vendor/yiisoft/yii2/base/Module.php:461

发现好像新建项目之后把SiteController删除了，于是决定新建一个项目，现在的命令较之前有些差别，贴出来：

```bash
php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
php -r "if (hash_file('SHA384', 'composer-setup.php') === '544e09ee996cdf60ece3804abc52599c22b1f40f4323403c44d44fdfdd586475ca9813a858088ffbc1f233e9b180f061') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;"
php composer-setup.php
php -r "unlink('composer-setup.php');"
php composer.phar create-project --prefer-dist --stability=dev yiisoft/yii2-app-basic /Users/apple/tjyx_backend
```

安装好之后测试了下**php yii serve --docroot='web' --port=8888**

在浏览器中输入**http://localhost:8888/index.php**

出现Congratulations!就说明项目基本完整，接下来就看功能了。

### 发请求出现的问题

测试请求返回值是否正确的时候，依然报了以下的错：

> exception 'yii\base\InvalidRouteException' with message 'Unable to resolve the request "site/error".' in /Users/yuzhiyuan/Documents/htdocs/yii-application/vendor/yiisoft/yii2/base/Module.php:461

找到了以下解决方案，本地测试返回了正确的返回值。在每个action前面加上这样一段话：

```php
public function beforeAction($action)
{
    $this->enableCsrfValidation = false;
    return parent::beforeAction($action);
}
```

### 修改权限

访问index.php首页的时候，出现了如下的错误：

> PHP warning
> chmod() has been disabled for security reasons

这个原因是asset权限不足，在ftp软件上修改成777即可。