---
title: 科学上网黑喂够
date: 2017-07-03 10:24:32
tags: 技术
---
一直在探索如何科学上网，经历了红杏、时空隧道、小狐狸的充年跑之后，决心开辟一条长期有效极速舒心的科学道路。
妈妈再也不用担心买裙裙的小钱钱扔进黄浦江了，服务更是比从前优秀了太多。
闲话不多说，迅速开始我们的探索之旅。
# 租用vps
[Vultr](https://www.vultr.com/?ref=7180046)是提供日本、美国、欧洲等多个国家地区机房的vps主机商，是目前市面上性价比较高的，最低档的带宽日常使用应该能结余不少，同时在线的可有3-5人，平摊到一人的费用大概7-12软妹币每月。

<!--more-->
Vultr的资费基本如图所示：
![](https://podcast.webview.tech/lolilukia/20200220mOcZyT.png)
实测2.5美刀的套餐已经停售，满送的活动也截止上半年，果然绝缘体的生涯就是这么坎坷。不管怎样，还是尽快上车。
Vultr不支持宝宝付款，不过注册个Paypal还是分分钟的事，so easy。

# 部署vps
注册[Vultr](http://www.vultr.com/?ref=7180046)之后，点击servers的蓝色加号，进入配置页面，前面两个配置建议如下，东京的速度比较快。
![](https://podcast.webview.tech/lolilukia/20200220WqzmIE.png)
![](https://cl.ly/3I2K2A00030y/download/Image%202017-07-03%20at%2011.24.11.public.png)

选资费的时候，我们看到2.5美刀的已经停售了，5美刀的3，5个小伙伴使用还是很稳的，当然还有其他资费可以选择。
![](https://podcast.webview.tech/lolilukia/20200220xdrxzL.png)

最后一项设置你vps的名字
![](https://podcast.webview.tech/lolilukia/20200220GtxsMx.png)

其他的都不用设置，然后直接点击部署
![](https://podcast.webview.tech/lolilukia/20200220Fd64qf.png)

# 连接vps
点击查看你刚部署的vps
![](https://podcast.webview.tech/lolilukia/20200220Lhm8bV.png)

借助一些连接远程服务器的软件比如xshell就可以访问你刚刚部署的vps,当然使用mac OSX的小伙伴可以直接用终端。
![](https://cl.ly/2D2w2x0T2k1e/download/Image%202017-07-03%20at%2011.34.38.public.png)

输入yes和密码，回车

如果有需要的话，可以配置免密登陆，首先输入命令

```bash
ssh-keygen
```

路径选择默认，key fingerprint直接回车，然后对ssh配置文件(/etc/ssh/sshd_config)进行修改，将以下几行取消注释

```bash
RSAAuthentication yes
PubkeyAuthentication yes
AuthorizedKeysFile  .ssh/authorized_keys
```

然后将我们个人计算中的密钥拷贝到服务器上

```bash
cat ~/.ssh/id_rsa.pub | ssh user@host "cat - >> ~/.ssh/authorized_keys"
```

进行重启

```bash
service sshd restart
```

然后我们就可以使用ssh root@ip来进行直接登陆了。

# Shadowsocks
需要同时在vps和你的pc上安装部署shadowsocks，首先在vps的centos 7上安装shadowsocks。

>wget --no-check-certificate https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.sh
>chmod +x shadowsocks.sh
>./shadowsocks.sh 2>&1 | tee shadowsocks.log

这是一个一键安装脚本，[使用详情](https://teddysun.com/342.html)

然后会提示你输入密码和端口，我们可以根据端口来分配用户，输入密码和端口之后，就出现了如下的信息
![](https://podcast.webview.tech/lolilukia/20200220OimYqu.png)

安装客户端shadowsocks
![](https://podcast.webview.tech/lolilukia/202002209bQmmo.png)

设置服务器设定
![](https://podcast.webview.tech/lolilukia/20200220YyIa2b.png)

### 设置多用户
如果想添加用户，修改vps上的json文件即可，输入以下的命令
> cd /etc
> vi shadowsocks.json


我这里的文件的内容如下：
![](https://podcast.webview.tech/lolilukia/20200220V2CGsH.png)

22345就是新添加的用户，设置一个独立的密码，就是在shadowsocks客户端配置的时候输入的。按i进入编辑模式，按esc退出编辑，再按两下大写z退出该文件，然后重启shadowsocks服务器端。

>/etc/init.d/shadowsocks restart



### VPS加速——TCP-BBR拥堵算法

TCP-BBR是谷歌推出的用来替代收费锐速的单边加速TCP连接效果的开源算法，主要思想是跑满带宽，且避免排队。

以下是CentOS7的执行步骤

#### 更换内核

```bash
rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm
yum --enablerepo=elrepo-kernel install kernel-ml -y
```

#### 查看内核是否安装成功

```bash
rpm -qa | grep kernel
```

#### 更新grub系统引导文件并重启

```bash
egrep ^menuentry /etc/grub2.cfg | cut -f 2 -d \'
grub2-set-default 0 #default 0表示第一个内核设置为默认运行, 选择最新内核就对了
reboot
```

#### 执行一键安装脚本

```bash
wget --no-check-certificate https://github.com/iyuco/scripts/raw/master/bbr.sh
chmod +x bbr.sh
./bbr.sh
```

提示重启，重启后登入VPS，验证内核是否安装成功

```bash
uname -r
```

检测是否生效

```bash
sysctl net.ipv4.tcp_available_congestion_control
```

返回值若为：net.ipv4.tcp_available_congestion_control = `bbr` cubic reno 即可

```bash
sysctl net.ipv4.tcp_congestion_control
```

返回值若为：net.ipv4.tcp_congestion_control = `bbr` 即可

```bash
sysctl net.core.default_qdisc
```

返回值若为：net.core.default_qdisc = fq 即可

```bash
lsmod | grep bbr
```

返回值有 `tcp_bbr` 模块即说明bbr已启动

最后一步，非常关键，如果你vps可以ssh登陆，却无法打开谷歌，有可能是因为没有关防火墙

```bash
systemctl stop firewalld.service
```



稳如狗
开始我们的科学上网之旅吧